<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ูุธุงู ุญุฌุฒ ููุงุนูุฏ ุฅุนุงุฏุฉ ุตุฑู ุงูุฃุฏููุฉ</title>
<style>
/* --- ููุณ ุงูุชูุณูู ุงูุฃุตูู ุจุงููุงูู --- */
body{font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(180deg,#1e5a96 0%,#2e7bb4 30%,#3b9dd9 60%,#e8f4f9 100%);min-height:100vh;padding:20px;direction:rtl}
.container{max-width:1000px;margin:auto}
/* ... ุงุฎุชุตุฑู ุจุงูู ุงูุชูุณูู ุจูุถุน ุงูุชูุณูู ุงููุฏูู ููุณู ููุง ุจูุง ุชุนุฏูู ... */
</style>
</head>
<body>
<div class="container">
<header>
  <img src="hospital_logo.png" class="hospital-logo" alt="ุดุนุงุฑ ุงููุณุชุดูู" />
  <p class="hospital-subtitle-text">ูุณู ุงูุตูุฏููุฉ</p>
  <h1>ูุธุงู ุญุฌุฒ ููุงุนูุฏ ุฅุนุงุฏุฉ ุตุฑู ุงูุฃุฏููุฉ</h1>
  <p class="header-subtitle">ุงุญุฌุฒ ููุนุฏู ูุณุจููุง ูุชุฌููุฒ ุฃุฏููุชู ูุชูููู ููุช ุงูุงูุชุธุงุฑ</p>
</header>

<div class="tabs">
  <button class="tab-btn active" onclick="switchTab(event,'booking')">๐ ูููุฐุฌ ุงูุญุฌุฒ</button>
  <button class="tab-btn" onclick="switchTab(event,'tracking')">๐ ุชุชุจุน ุงูุทูุจ</button>
  <button class="tab-btn" onclick="switchTab(event,'admin')">๐ ููุญุฉ ุงูุฅุฏุงุฑุฉ</button>
</div>

<!-- ูููุฐุฌ ุงูุญุฌุฒ -->
<div id="booking" class="tab-content active">
  <div id="bookingMessage" class="message"></div>
  <form id="bookingForm">
    <label>ุฑูู ุงููููุฉ *</label>
    <input type="text" id="nationalId" required maxlength="10" />
    <label>ุงุณู ุงููุฑูุถ *</label>
    <input type="text" id="patientName" required />
    <label>ุฑูู ุงููุงุชู *</label>
    <input type="tel" id="phoneNumber" required />
    <label>ุงูููู ุงูููุถู ููุงุณุชูุงู *</label>
    <input type="date" id="appointmentDate" required />
    <label>ููุงุญุธุงุช ุฅุถุงููุฉ</label>
    <textarea id="notes"></textarea>
    <button type="submit">ุชุณุฌูู ุงูููุนุฏ</button>
  </form>
</div>

<!-- ููุญุฉ ุงูุฅุฏุงุฑุฉ -->
<div id="admin" class="tab-content">
  <div id="adminLogin">
    <div id="adminMessage" class="message"></div>
    <form id="adminForm">
      <label>ูููุฉ ุงููุฑูุฑ</label>
      <input type="password" id="adminPassword" required />
      <button type="submit">ุชุณุฌูู ุงูุฏุฎูู</button>
    </form>
  </div>
  <div id="adminPanel" style="display:none">
    <button onclick="adminLogout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
    <div id="bookingsList"></div>
  </div>
</div>

<footer style="text-align:center;color:#666;margin-top:30px">
  <p>ยฉ 2025 HBTGH Pharmacy</p>
</footer>
</div>

<script type="module">
// --- Firebase init (ุงุณุชุฎุฏู ููุงุชูุญู ุงูุชู ุฃุฑุณูุชูุง) ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, deleteDoc } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAhIp9CnEgptjBO4oM_xaZhsuqaSsufn-k",
  authDomain: "pharmacybooking-c7cd6.firebaseapp.com",
  projectId: "pharmacybooking-c7cd6",
  appId: "1:297721612359:web:03dc37f4d1fc07eac24962"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- ุงููุชุบูุฑุงุช ---
const ADMIN_PASSWORD = "10551055";
let isAdmin = false;

// --- ุชุจุฏูู ุงูุชุจููุจุงุช ---
function switchTab(e, name){
 document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
 document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
 document.getElementById(name).classList.add('active');
 e.target.classList.add('active');
 if(name==="admin" && isAdmin) loadAdmin();
}

// --- ุฑุณุงูุฉ ---
function showMessage(id,msg,type="success"){
 const el=document.getElementById(id);
 el.textContent=msg;
 el.style.display="block";
 el.style.background=type==="error"?"#f8d7da":"#d4edda";
 el.style.color=type==="error"?"#721c24":"#155724";
 setTimeout(()=>{el.style.display="none"},4000);
}

// --- ุฅุฑุณุงู ุญุฌุฒ ---
document.getElementById("bookingForm").addEventListener("submit",async(e)=>{
 e.preventDefault();
 const booking={
  nationalId:document.getElementById("nationalId").value.trim(),
  patientName:document.getElementById("patientName").value.trim(),
  phoneNumber:document.getElementById("phoneNumber").value.trim(),
  appointmentDate:document.getElementById("appointmentDate").value,
  notes:document.getElementById("notes").value.trim(),
  status:"pending",
  createdAt:new Date().toISOString()
 };
 try{
  await addDoc(collection(db,"bookings"),booking);
  showMessage("bookingMessage","โ ุชู ุชุณุฌูู ููุนุฏู ุจูุฌุงุญ!","success");
  e.target.reset();
 }catch(err){
  showMessage("bookingMessage","ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ","error");
 }
});

// --- ุฏุฎูู ุงููุฏูุฑ ---
document.getElementById("adminForm").addEventListener("submit",(e)=>{
 e.preventDefault();
 if(document.getElementById("adminPassword").value===ADMIN_PASSWORD){
   isAdmin=true;
   document.getElementById("adminLogin").style.display="none";
   document.getElementById("adminPanel").style.display="block";
   loadAdmin();
 }else{
   showMessage("adminMessage","ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ","error");
 }
});

// --- ุชุณุฌูู ุฎุฑูุฌ ---
function adminLogout(){
 isAdmin=false;
 document.getElementById("adminLogin").style.display="block";
 document.getElementById("adminPanel").style.display="none";
}

// --- ุชุญููู ุงูุญุฌูุฒุงุช ---
async function loadAdmin(){
 const list=document.getElementById("bookingsList");
 list.innerHTML="ุฌุงุฑู ุงูุชุญููู...";
 const snap=await getDocs(collection(db,"bookings"));
 let data=[];
 snap.forEach(d=>data.push({id:d.id,...d.data()}));
 data.sort((a,b)=>new Date(a.appointmentDate)-new Date(b.appointmentDate));
 if(data.length===0){list.innerHTML="<p>ูุง ุชูุฌุฏ ุญุฌูุฒุงุช</p>";return;}
 list.innerHTML=data.map(b=>`
  <div class="booking-item" style="background:#f8f9fa;border:1px solid #ddd;padding:10px;margin-bottom:10px">
   <strong>${b.patientName}</strong> โ ${b.nationalId}<br>
   ุงูููุนุฏ: ${b.appointmentDate}<br>
   ุงูุญุงูุฉ: ${b.status}<br>
   <button onclick="updateStatus('${b.id}','pending')">ููุฏ ุงูุงูุชุธุงุฑ</button>
   <button onclick="updateStatus('${b.id}','completed')">ุชู ุงูุตุฑู</button>
   <button onclick="updateStatus('${b.id}','rejected')">ูุฑููุถ</button>
   <button onclick="deleteBooking('${b.id}')">๐๏ธ ุญุฐู</button>
  </div>`).join('');
}

// --- ุชุญุฏูุซ ุงูุญุงูุฉ ---
window.updateStatus=async(id,status)=>{
 await updateDoc(doc(db,"bookings",id),{status});
 loadAdmin();
};

// --- ุญุฐู ---
window.deleteBooking=async(id)=>{
 if(confirm("ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุญุฌุฒุ")){
  await deleteDoc(doc(db,"bookings",id));
  loadAdmin();
 }
};
</script>
</body>
</html>
